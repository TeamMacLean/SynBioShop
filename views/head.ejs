<% include ./head-no-nav.ejs %>

<nav class="nav">
    <div class="brand">
        <a href="/">
            <span>SynBio</span>
        </a>
    </div>
    <div class="pull-right">

        <div class="search">
            <input id="seach-input" type="text" placeholder="Search">
        </div>

        <div id="search-results" class="search-results hidden">
            <ul>

            </ul>
        </div>

        <% if(locals.signedInUser){ %>
        <a href="/cart" class="nav-cart">
            <span class="icon" data-icon="&#xe015;"></span>
            <span class="count"><%- locals.signedInUser.cart.items.length %> item(s)</span>
        </a>
        <% } %>

        <div class="user">
            <% if(locals.signedInUser){ %>

            <a href="/whoami">
                <div class="image">
                    <img src="<%- locals.signedInUser.iconURL %>">
                </div>
                <div class="name">
                    <span><%- locals.signedInUser.name %></span>
                </div>
            </a>
            <div class="user-menu hidden">
                <ul>
                    <li>
                        <a href="/signout">Sign out</a>
                    </li>
                </ul>
            </div>

            <% } else { %>
            <div class="name">
                <a href="/signin">Sign in</a>
            </div>
            <% } %>
        </div>
    </div>
</nav>

<script>
    $(function () {

        var resultsDiv = $('#search-results').removeClass('hidden');

        $('#seach-input').on('input', function () {
            var text = $(this).val();

            if (text.length > 0) {
                sendSearch(text);
            } else {
                resultsDiv.empty();
            }

        })

        socket.on('results', function (results) {

            resultsDiv.empty();

            results.map(function (result) {
                resultsDiv.append('<i>' + result.name + '</i>');
            });

        })

        function sendSearch(text) {
            socket.emit('search', text);
        }
    })

</script>
