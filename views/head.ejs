<%- include('./head-no-nav.ejs') %>

<nav class="nav">
    <div class="brand">
        <a href="/">
            <span>SynBio</span>
        </a>
    </div>
	<img src="/img/tsl-core-logo-blue.png" class="pull-left nav-top-left" style="height: 100%; padding: 2px;">
	</img>

	<div class="pull-right nav-top-right">
	    <% if(locals.signedInUser){ %>

	    <% if(!locals.disablePremade){ %>
	    <div class="search">
	        <form method="get" action="/search">
	            <input name="queryString" id="search-input" type="text" placeholder="Enter text here...">
	            <button>Search</button>
	        </form>
	    </div>

	    <div id="search-results" class="search-results hidden">
	        <ul></ul>
	    </div>
	    <% } %>

	    <% if(!locals.disableCart){ %>
	    <a href="/cart" class="nav-cart">
	        <span class="icon" data-icon="&#xe015;"></span>
	        <span class="count"><%- locals.signedInUser.cart.items.length %></span>
	    </a>
	    <% } %>

	    <% } %>

	    <div class="user">
	        <% if(locals.signedInUser){ %>
	        <div class="image">
	            <img src="<%- locals.signedInUser.iconURL %>">
	            <% if(locals.signedInUser.isAdmin){ %>
	            <span class="badge"><%- locals.incompleteCount %></span>
	            <% } %>
	        </div>
	        <div class="name">
	            <span><%- locals.signedInUser.name %></span>
	        </div>
	        <div class="user-menu hidden">
	            <ul>
	                <% if (locals.signedInUser.isAdmin){ %>
	                <li>
	                    <a href="/admin/billboard">Billboard</a>
	                </li>
	                <li>
	                    <a href="/filemanager">File Manager</a>
	                </li>
	                <% } %>
	                <li>
	                    <a href="/orders">My Orders</a>
	                </li>
	                <li>
	                    <a href="/signout">Sign out</a>
	                </li>
	            </ul>
	        </div>

	        <% } else { %>
	        <div class="name">
	            <a href="/signin">Sign in</a>
	        </div>
	        <% } %>
	    </div>
	</div>

</nav>

<% /* Flash Messages - Fixed to show only latest and auto-dismiss */ %>
<% if (typeof messages !== 'undefined') { %>
  <% if (messages.success && messages.success.length > 0) { %>
    <% const latestSuccess = Array.isArray(messages.success) ? messages.success[messages.success.length - 1] : messages.success; %>
    <div class="flash-messages flash-success">✓ <%= latestSuccess %></div>
  <% } %>
  <% if (messages.error && messages.error.length > 0) { %>
    <% const latestError = Array.isArray(messages.error) ? messages.error[messages.error.length - 1] : messages.error; %>
    <div class="flash-messages flash-error">✕ <%= latestError %></div>
  <% } %>
  <% if (messages.warning && messages.warning.length > 0) { %>
    <% const latestWarning = Array.isArray(messages.warning) ? messages.warning[messages.warning.length - 1] : messages.warning; %>
    <div class="flash-messages flash-warning">⚠ <%= latestWarning %></div>
  <% } %>
  <% if (messages.info && messages.info.length > 0) { %>
    <% const latestInfo = Array.isArray(messages.info) ? messages.info[messages.info.length - 1] : messages.info; %>
    <div class="flash-messages flash-info">ℹ <%= latestInfo %></div>
  <% } %>
<% } %>

<% /* Inline styles for flash messages, to ensure they work */ %>

<style>
    .flash-messages {
        padding: 12px 20px;
        margin: 15px auto;
        border-radius: 6px;
        text-align: center;
        max-width: 600px;
        border: 1px solid transparent;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        font-weight: 500;
        animation: slideDown 0.3s ease-out, fadeOut 0.5s ease-in 4.5s;
        position: relative;
        z-index: 1000;
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeOut {
        from {
            opacity: 1;
        }
        to {
            opacity: 0;
        }
    }

    .flash-success {
        background-color: #d4edda;
        color: #155724;
        border-color: #c3e6cb;
    }
    .flash-error {
        background-color: #f8d7da;
        color: #721c24;
        border-color: #f5c6cb;
    }
    .flash-warning {
        background-color: #fff3cd;
        color: #856404;
        border-color: #ffeeba;
    }
    .flash-info {
        background-color: #d1ecf1;
        color: #0c5460;
        border-color: #bee5eb;
    }
</style>

<script>
    // Auto-dismiss flash messages after 5 seconds
    document.addEventListener('DOMContentLoaded', function() {
        const flashMessages = document.querySelectorAll('.flash-messages');
        flashMessages.forEach(function(message) {
            setTimeout(function() {
                message.style.display = 'none';
            }, 5000);
        });
    });
</script>
