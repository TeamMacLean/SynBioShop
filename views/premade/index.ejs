<%- include('../head.ejs') %>
<%- include('./sidebar.ejs') %>

<div class="sidebar-push">
    <div class="container">

        <% if(locals.signedInUser && locals.signedInUser.isAdmin){ %>
        <div class="tile pad inverted">
            <h4>Admin Actions</h4> <% /* Changed from 'Admin' to 'Admin Actions' for consistency */ %>
            <div class="form-group button-group"> <% /* Added button-group class for styling */ %>
                <a href="/premade/new" class="button primary">New Database</a> <% /* Clarified button text */ %>
                <a href="/premade/rearrange" class="button primary">Rearrange Databases/Categories</a> <% /* Clarified button text */ %>
                <a href="/premade/export" class="button primary">Export to CSV</a>
            </div>
        </div>
        <% } %>

        <h1 class="center">Pre Made Items</h1> <% /* Changed to 'Pre Made Items' for clarity */ %>

        <div class="simon-list">
            <% /* Iterate through top-level Databases */ %>
            <% dbs.sort((a, b) => a.position - b.position).forEach(function(db){ %> <% /* Changed map to forEach */ %>
                <% if (!db.disabled || (locals.signedInUser && locals.signedInUser.isAdmin)) { %> <% /* Simplified admin display logic */ %>
                    <h2 class="<% if(db.disabled){ %>disabled<% } %>"><%- db.name %></h2>
                    <ul>
                        <% /* Iterate through Categories within this DB */ %>
                        <% db.categories.sort((a, b) => a.position - b.position).forEach(function(category){ %> <% /* Changed map to forEach */ %>
                            <% if (!category.disabled || (locals.signedInUser && locals.signedInUser.isAdmin)) { %> <% /* Simplified admin display logic */ %>
                                <div class="indent"> <% /* Keep this div if essential for styling */ %>
                                    <li>
                                        <a 
                                            class="<% if(category.disabled){ %>disabled<% } %>"
                                            href="/premade/category/<%- category.id %>"
                                        >
                                            <span data-icon="&#xe017;"></span> <%- category.name %>
                                        </a>
                                    </li>
                                </div>
                            <% } %>
                        <% }); %>
                    </ul>
                <% } %>
            <% }); %>
        </div>
    </div>
</div>

<%- include('../foot.ejs') %>