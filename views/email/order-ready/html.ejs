<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>SynBio Order Ready for Collection</title>
   <style type="text/css">
        body { margin: 0; padding: 0; background-color: #f4f4f4; font-family: Arial, sans-serif; line-height: 1.6; }
        .email-container { 
            width: 100%; 
            margin: 20px auto; 
            padding: 10px;
            background-color: #ffffff; 
            border: 1px solid #dddddd; 
            border-collapse: collapse; 
            table-layout: fixed; /* NEW: Crucial for consistent column widths */
        }
        .header { background-color: #f8f8f8; padding: 20px; text-align: center; border-bottom: 1px solid #dddddd; }
        .header img { max-width: 80px; height: 80px; display: block; margin: 0 auto 10px auto; }
        .header h1 { margin: 0; font-size: 24px; color: #333333; }
        .order-info { padding: 20px; text-align: center; }
        .order-info p { margin: 0 0 10px 0; }
        .order-info a { color: #007bff; text-decoration: none; }
        .order-info a:hover { text-decoration: underline; }
        /* MODIFIED: Ensure wrapping for instructions and agreement text */
        .instructions, .agreement-text { 
            padding: 0 20px 20px 20px; 
            font-size: 13px; 
            color: #555555; 
            /* Force text wrapping within these TD cells */
            word-wrap: break-word; /* Older syntax */
            overflow-wrap: break-word; /* Newer syntax */
            word-break: break-all; /* Aggressive break for any word that overflows */
            white-space: normal; /* Ensure default wrapping */
            line-height: 1.6; /* Ensure line height is consistent */
        }
        .instructions p, .agreement-text p { margin: 0 0 10px 0; }
        .instructions strong { color: #333333; }
        .instructions .important-note { text-decoration: underline; margin-bottom: 1em; display: block; }
        .instructions a { color: #007bff; text-decoration: underline; }
        .section-title { background-color: #eeeeee; padding: 10px 20px; font-size: 18px; color: #333333; border-bottom: 1px solid #dddddd; }
        
        /* Fixed: Apply padding to the TD containing the table for consistent margins */
        .table-container-td {
            padding: 0 20px; 
            vertical-align: top;
        }
        
        .content-table { 
            width: 100%; 
            border-collapse: collapse; 
            table-layout: fixed; /* NEW: Important for reliable column widths */
        }
        .content-table th, .content-table td { 
            padding: 12px; 
            text-align: left; 
            border-bottom: 1px solid #dddddd; 
            /* Force text wrapping within cells if content is too long */
            word-wrap: break-word; 
            overflow-wrap: break-word;
            white-space: normal; /* Ensure text can wrap */
        }
        .content-table th.center, .content-table td.center { text-align: center; }
        .content-table th { background-color: #f8f8f8; font-weight: bold; color: #333333; }
        
        /* New explicit widths for THs to control layout reliably */
        .content-table th:nth-child(1) { width: 30%; } /* Item */
        .content-table th:nth-child(2) { width: 10%; } /* Quantity */
        .content-table th:nth-child(3) { width: 15%; } /* Price */
        .content-table th:nth-child(4) { width: 25%; } /* Concentration */
        .content-table th:nth-child(5) { width: 20%; } /* SynBio ID */
        
        /* Sum of above widths is 100%. If Price is conditional, need to adjust */
        /* If price is hidden, the column sum would be 80%. This might shift columns. */
        /* A more robust approach if columns are dynamic is to define fixed pixel widths for crucial columns. */

        .content-table tbody tr:nth-child(even) { background-color: #f9f9f9; }
        .content-table tfoot td { font-weight: bold; background-color: #eeeeee; }
        .footer { padding: 20px; text-align: center; font-size: 12px; color: #777777; border-top: 1px solid #dddddd; }
        .footer a { color: #777777; text-decoration: underline; }
        .agreement-text { padding: 0 20px 20px 20px; font-size: 13px; color: #555555; }
        .agreement-text p { margin: 0 0 10px 0; }
        .agreement-text a { color: #007bff; text-decoration: underline; }
    </style>
</head>
<body>
    <table class="email-container" border="0" cellpadding="0" cellspacing="0">
        <!-- Header -->
        <tr>
            <td class="header">
                <img src="<%= baseURL %>/img/logo.png" alt="TSL SynBio Logo">
                <h1>SynBio Order Ready</h1>
            </td>
        </tr>
        
        <!-- Order Info -->
        <tr>
            <td class="order-info">
                <p><%= (locals.order && locals.order.janCode) || 'N/A' %> is ready to collect from SynBio.</p>
            </td>
        </tr>

        <!-- Collection Instructions -->
        <tr>
            <td class="section-title">Collection Instructions</td>
        </tr>
        <tr>
            <td class="instructions">
                <p>Plasmids should be collected from the SynBio collection box, located immediately to the left of the TSL agar plates in the TSL first floor cold room (Room #131).</p>
                <p>All orders will be contained in small, clear plastic bags and will be clearly labelled with their respective SynBio order number (as shown above).</p> 
                <p>Orders will be strictly arranged with the most recent order at the front. Please do NOT alter this order when searching/collecting your own order(s).</p>
                <p>When collecting your plasmids please check the contents of each bag carefully against your own records.</p>
                <p>If you encounter any problems, please see Mark or Liam (Office: TSL Ground Floor, room G70a or SynBio lab bench: TSL floor 1, room 140).</p>
                <div class="important-note"><strong>Important note:</strong></div>
                <p>
                    TSL SynBio material supplied to TSL & JIC scientists is subject to a Material Transfer Agreement & mustn't be distributed/shared with any parties beyond TSL/JIC. 
                </p>
                <p>
                    Any third parties who request use of such material should be directed to TSL SynBio (please email <a href="mailto:Mark.Youles@tsl.ac.uk">Mark.Youles@tsl.ac.uk</a>).
                </p>
                <p>
                    Material supplied by TSL SynBio is for non-commercial research purposes only. 
                </p>
                <p>
                    If you wish to use supplied material for commercial purposes, please contact <a href="mailto:Mark.Youles@tsl.ac.uk">Mark.Youles@tsl.ac.uk</a>.
                </p>
                <p>
                    Once you have emailed, then an appropriate MTA can be drawn up.
                </p>
            </td>
        </tr>
        
        <!-- Order Details Table -->
        <tr>
            <td class="section-title">Order Details</td>
        </tr>
        <tr>
            <td>
                <table class="content-table" border="0" cellpadding="0" cellspacing="0">
                    <thead>
                        <tr>
                            <th class="center">Item</th>
                            <th class="center">Quantity</th>
                            <% if (locals.order && locals.order.totalCost) { %>
                                <th class="center">Price (£)</th>
                            <% } %>
                            <th class="center">Concentration</th>
                            <th class="center">SynBio ID</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (locals.order && locals.order.items && locals.order.items.length > 0) { %>
                            <% locals.order.items.forEach(function(item){ %>
                                <tr>
                                    <td><%= (item && item.type && item.type.name) || 'N/A' %></td>
                                    <td class="center"><%= item.quantity || 0 %></td>
                                    <% if (locals.order && locals.order.totalCost) { %>
                                        <td class="center">£<%= ((item.quantity || 0) * (locals.order.pricePerUnit || 0)).toFixed(2) %></td>
                                    <% } %>
                                    <td class="center"><%= (item && item.type && item.type.concentration) || 'N/A' %></td>
                                    <td class="center"><%= (item && item.type && item.type.synBioID) || 'N/A' %></td>
                                </tr>
                            <% }); %>
                        <% } else { %>
                            <tr>
                                <td colspan="5" class="center">No items found for this order.</td>
                            </tr>
                        <% } %>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td><b>Total</b></td>
                            <td class="center">
                                <b>
                                    <%= locals.order.totalQuantity %>
                                </b>
                            </td>
                            <% if (locals.order) { %>
                                <% if (locals.order.totalCost) { %>
                                    <td class="center">
                                        <b>£
                                            <%= Number(locals.order.totalCost).toFixed(2) %>
                                        </b>
                                    </td>
                                <% } %>
                            <% } %>
                            <td></td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </td>
        </tr>
        
        <!-- Footer Link -->
        <tr>
            <td class="footer">
                <a href="<%= baseURL %>/order/<%= (locals.order && locals.order.id) || '' %>">View order on site</a>
            </td>
        </tr>
    </table>
</body>
</html>